<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Log_flow_Error</name>
        <label>Log flow Error</label>
        <locationX>916</locationX>
        <locationY>793</locationY>
        <actionName>FlowInvokableActions</actionName>
        <actionType>apex</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>errorTextTemplate</name>
            <value>
                <elementReference>FlowFailureTextTemplate</elementReference>
            </value>
        </inputParameters>
        <nameSegment>FlowInvokableActions</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>53.0</apiVersion>
    <assignments>
        <name>Add_failed_record_update_to_error_logs</name>
        <label>Add failed record update to error logs</label>
        <locationX>398</locationX>
        <locationY>1143</locationY>
        <assignmentItems>
            <assignToReference>FailedActions</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>Failed to update records</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Log_flow_Error</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Failed_Checklist_Id_to_failed_actions</name>
        <label>Assign Failed Checklist Id to failed actions</label>
        <locationX>403</locationX>
        <locationY>569</locationY>
        <assignmentItems>
            <assignToReference>FailedActions</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>Checklist ID not provided for flow to run</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Log_flow_Error</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Failed_medical_Id_to_failed_actions</name>
        <label>Assign Failed medical Id to failed actions</label>
        <locationX>406</locationX>
        <locationY>798</locationY>
        <assignmentItems>
            <assignToReference>FailedActions</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>Failed to query medical record</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Log_flow_Error</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_failed_query_of_checklist</name>
        <label>Assign failed query of checklist</label>
        <locationX>379</locationX>
        <locationY>395</locationY>
        <assignmentItems>
            <assignToReference>FailedActions</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>Improper query for checklist form</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Log_flow_Error</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_no_medical_form_returned_to_failed_actions</name>
        <label>Assign no medical form returned to failed actions</label>
        <locationX>415</locationX>
        <locationY>943</locationY>
        <assignmentItems>
            <assignToReference>FailedActions</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>Did not get a matching medical form for checklsit</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Log_flow_Error</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Handle_checklist_query_result</name>
        <label>Handle checklist query result</label>
        <locationX>181</locationX>
        <locationY>574</locationY>
        <defaultConnector>
            <targetReference>Get_Medical_Questionnaire_for_this_checklist</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Checklist was found</defaultConnectorLabel>
        <rules>
            <name>No_Checklist_is_Found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Checklist</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Failed_Checklist_Id_to_failed_actions</targetReference>
            </connector>
            <label>No Checklist is Found</label>
        </rules>
    </decisions>
    <decisions>
        <name>If_no_medical_form_is_returned_from_the_query</name>
        <label>If no medical form is returned from the query</label>
        <locationX>185</locationX>
        <locationY>944</locationY>
        <defaultConnector>
            <targetReference>Clear_Medical_Questionnaire_Values</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Update Medical Questionnaire Fields</defaultConnectorLabel>
        <rules>
            <name>If_no_medical_form_is_returned</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>MedicalQUestionnaire</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_no_medical_form_returned_to_failed_actions</targetReference>
            </connector>
            <label>If no medical form is returned</label>
        </rules>
    </decisions>
    <description>Flow triggered after save of user record update:
Only one entry point as of now. A portal user(Cust Comm Login User Clone Profile) &amp; they have an accountId &amp; they&apos;re updated to inactive</description>
    <interviewLabel>PEO Edge clear medical AKN after portal user deactivate {!$Flow.CurrentDateTime}</interviewLabel>
    <label>PEO Edge clear medical AKN after portal user deactivate</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_Checklist_using_account_ID_of_user</name>
        <label>Get Checklist using account ID of user</label>
        <locationX>195</locationX>
        <locationY>393</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Handle_checklist_query_result</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Assign_failed_query_of_checklist</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Prospect_Client__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.AccountId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Medical_Benefits_Underwriting_Requested__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Yes</stringValue>
            </value>
        </filters>
        <object>PEO_Onboarding_Checklist__c</object>
        <outputReference>Checklist</outputReference>
        <queriedFields>Id</queriedFields>
    </recordLookups>
    <recordLookups>
        <description>Retrieves the medical questionnaire for the provided checklist ID and stores it in the Medical_Questionnaire variable. Gets:
- Acknowledged_By__c
- Acknowledgement_Agreed_Stamp__c
- PEO_Onboarding_Checklist__c
Values saved as null on medical_Questionnaire if the fields are empty</description>
        <name>Get_Medical_Questionnaire_for_this_checklist</name>
        <label>Get Medical Questionnaire for this checklist</label>
        <locationX>194</locationX>
        <locationY>796</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>If_no_medical_form_is_returned_from_the_query</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Assign_Failed_medical_Id_to_failed_actions</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>PEO_Onboarding_Checklist__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Checklist.Id</elementReference>
            </value>
        </filters>
        <object>PEO_Onboarding_Medical_Questionnaire__c</object>
        <outputReference>MedicalQUestionnaire</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Acknowledged_By__c</queriedFields>
        <queriedFields>Acknowledgement_Agreed_Stamp__c</queriedFields>
        <queriedFields>PEO_Onboarding_Checklist__c</queriedFields>
    </recordLookups>
    <recordUpdates>
        <name>Clear_Medical_Questionnaire_Values</name>
        <label>Clear Medical Questionnaire Values</label>
        <locationX>190</locationX>
        <locationY>1158</locationY>
        <faultConnector>
            <targetReference>Add_failed_record_update_to_error_logs</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>MedicalQUestionnaire.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Acknowledgement_Agreed_Stamp__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>Client_Id_user_agreement_acknowledgment__c</field>
        </inputAssignments>
        <object>PEO_Onboarding_Medical_Questionnaire__c</object>
    </recordUpdates>
    <start>
        <locationX>54</locationX>
        <locationY>50</locationY>
        <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
        <filterLogic>and</filterLogic>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>ProfileName__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Customer Community Login User Clone</stringValue>
            </value>
        </filters>
        <filters>
            <field>AccountId</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <object>User</object>
        <recordTriggerType>Update</recordTriggerType>
        <scheduledPaths>
            <connector>
                <targetReference>Get_Checklist_using_account_ID_of_user</targetReference>
            </connector>
            <pathType>AsyncAfterCommit</pathType>
        </scheduledPaths>
        <scheduledPaths>
            <name>After_90_Days</name>
            <label>After 90 Days</label>
            <offsetNumber>90</offsetNumber>
            <offsetUnit>Days</offsetUnit>
            <timeSource>RecordTriggerEvent</timeSource>
        </scheduledPaths>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <description>Stores the text template to be provided to the error logger in the event of failure</description>
        <name>FlowFailureTextTemplate</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;Flow Name: PEO Edge Med Akn Clear 90 Days After Medical Approval&lt;/p&gt;&lt;p&gt;Failed Actions(s): {!FailedActions}&lt;/p&gt;&lt;p&gt;Err Msg: {!$Flow.FaultMessage}&lt;/p&gt;&lt;p&gt;User: &lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;{!$User.Full_Name__c}﻿&lt;/span&gt;&lt;/p&gt;</text>
    </textTemplates>
    <variables>
        <name>Checklist</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>PEO_Onboarding_Checklist__c</objectType>
    </variables>
    <variables>
        <name>FailedActions</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>MedicalQUestionnaire</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>PEO_Onboarding_Medical_Questionnaire__c</objectType>
    </variables>
    <variables>
        <description>Stores the id of the checklist this process was triggered from.</description>
        <name>StoredChecklistId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <elementReference>$Record__Prior.Id</elementReference>
        </value>
    </variables>
</Flow>
