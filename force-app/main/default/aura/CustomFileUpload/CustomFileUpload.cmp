<aura:component controller="CommunityFileUploadController" implements="force:appHostable" access="global">
    <aura:attribute name="attachmentUploaded" type="Boolean" default="false" />
    <aura:attribute name="accountForUpload" type="Account"/>
    <aura:attribute name="mainAccountId" type="Id"/>
    <aura:attribute name="customPEOCheckList" type="Object"/>
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/> 
    <aura:attribute name="KnowledgeData" type="Knowledge__kav"
                    default="{ 'sobjectType': 'Knowledge__kav'}"/>
    <aura:attribute name="knowledgeId" type="string" default=""/>
    <aura:attribute name="knowledgeUrl" type="string" default=""/>
    <aura:attribute name="ArticleBody" type="string"/>
    <aura:attribute name="attachmentParent" type="Id"/>
    <aura:attribute name="documentName" type="String"/>
    <aura:attribute name="settingName" type="String"/>
    <aura:attribute name="attachedFiles" type="ContentDocument[]"/>
    <aura:attribute name="submittedFiles" type="ContentDocument[]"/>
    <aura:attribute name='accountStatusNotProspect' type='boolean'/>
    <aura:attribute name="PEOCheckList" type="Object"/>
    <aura:attribute name="uploadTargetId" type="String"/>
    <aura:attribute name="acceptFileTypes" type="String" default=".pdf, .jpg, .png, .doc, .docx, .txt, .xlsx, .xlsm, .csv"/>
    <aura:attribute name="uploadMultiple" type="Boolean" default="true"/>      
    <aura:attribute name="showSpinner" type="boolean" default="false"/>
    <aura:attribute name="PEO_Map" type="Object"/>
    <aura:attribute name="KnowledgeFilesMap" type="Map"/>
    <aura:attribute name="KnowledgeFilesList" type="Map"/>
    <aura:attribute name="contentUrl" type="Object[]"/>
    <aura:attribute name='isParent' type='Boolean'  />	
    <aura:attribute name='disableFilesUpload' type='boolean'/>
    <aura:attribute name="downloadORshowme" type="string" default="Show Me" />
    <aura:attribute name="downloadClick" type="boolean" default="false" />
    <aura:attribute name="isCommUser" type="boolean" default="false" />
    <aura:attribute name="contentUrls" type="List"/>
    <aura:attribute name="showTemplateButton" type="Boolean" default="false"/>
    <aura:attribute name="uploadTitle" type="String"/>
    <aura:attribute name="nmbrOfAttchments" type="Integer" default="0"/>
    <aura:attribute name="TabiconName" type="string" />
    <aura:attribute name="DocumentLabel" type="string" />
    <aura:attribute name="Docrequiredlabel" type="string" />
    <aura:attribute name="ShowhelpText" type="string" default="Show Me" />
	<aura:registerEvent name="PEOUWCompFileUploadEvent" type="c:PEOUWFileUploadEvent"/>
    <aura:attribute name="isCommunityUser" type="Boolean"/>

    <div style="font-size:16px; padding-left: 40px;font-family: Graphik-Regular-Web;"><b>{!v.DocumentLabel} {!v.Docrequiredlabel}</b><br/></div>    
      <div class="c-container slds-p-left_large">
        <lightning:layout >
            <lightning:layoutItem class="slds-col slds-size_2-of-5">                
                 <lightning:fileUpload multiple="{!v.uploadMultiple}"   
                              accept="{!v.acceptFileTypes}" 
                              recordId="{!v.uploadTargetId}"   
                              onuploadfinished="{!c.uploadFinished}"
                              fileFieldName="Onboarding_Document_Id_fileupload__c"
                              fileFieldValue="{!v.attachmentParent}"
                              disabled="{!v.disableFilesUpload}"/>
            </lightning:layoutItem>
            <lightning:layoutItem class="slds-col slds-size_3-of-5">
                <div class="slds-col slds-size_1-of-1 slds-large-size_12-of-12 slds-p-left_xx-large slds-p-horizontal_x-large" style="margin-top:35px" >         
                    <aura:if isTrue="{!v.knowledgeId !=null &amp;&amp; v.PEO_Map!=null }">
                        <aura:if isTrue="{!v.showTemplateButton == true}">
                            
                            <!--<lightning:button label="{!v.downloadORshowme}" onclick="{! c.handleShowMe }"></lightning:button>-->
                            
                            <aura:if isTrue="{!v.downloadORshowme=='Download'}"> 
                                <div  class="slds-m-bottom_medium" style="font-size:medium;">Don't Have This?</div>
                                <div class="templateborder">
                                    <lightning:icon iconName="doctype:gdoc" alternativeText="Template" title="Template" size="small"/>
                                    <span style="font-weight:bold">&nbsp;&nbsp;&nbsp;<lightning:button variant="base" class="buttonlabel"
                                                                                                       label="Download Our Template" onclick="{! c.handleShowMe }">
                                        </lightning:button>&nbsp;&nbsp;	</span> 
                                    <aura:if isTrue="{!v.ShowhelpText=='Show Me'}"> 
                                        <lightning:helptext content="Please download and use this census template to add your census information. After inputting your census information please save and download a copy."></lightning:helptext>
                                    </aura:if></div>
                                <aura:set attribute="else">
                                    <div  class="slds-m-bottom_medium" style="font-size:medium;">Don't Have This?</div>
                                    <lightning:icon iconName="doctype:gdoc" alternativeText="Template" title="Template" size="small" />
                                    <span style="font-weight:bold">&nbsp;&nbsp;&nbsp;<lightning:button variant="base" 
                                                                                                       class="buttonlabel"
                                                                                                       label="Show Me Examples" 
                                                                                                       onclick="{! c.handleShowMe }">
                                        </lightning:button>&nbsp;&nbsp;	</span> 
                                    <!-- <aura:if isTrue="{!v.downloadORshowme=='WCPricingLink'}"> 
                        <div><a onclick="{!c.handleShowMe}" class='WCPricingLink'>
                           Please click here for examples of the WC rates and Pricing
                        </a></div>
                        <aura:set attribute="else">
                            <lightning:button label="Show Me Examples" onclick="{! c.handleShowMe }"></lightning:button>
                        </aura:set>
                    </aura:if>-->
                                </aura:set>
                            </aura:if>
                            <aura:if isTrue="{!and(and(v.PEOCheckList.Medical_Underwriting_Path_Type__c == 'Quick Quote - Medical', not(v.isCommunityUser)), v.documentName == 'Census')}">
                                <div  class="slds-m-bottom_small" style="font-size:small;">
                                    <br/>
                                    <p>Be sure your census is properly converted before submission. A full conversion guide can be found <b><a href="javascript:void(0)" onclick="{!c.openURL}"> HERE </a></b></p>
                                    <div class="slds-text-longform">
                                        <ol>
                                            <li>Download our template</li>
                                            <li>Enter all required information</li>
                                            <li>Convert the census to the proper format (completed in the census itself)</li>
                                            <li>Upload the converted census to this section</li>
                                            <li>Proceed with submission</li>
                                            <li>Success or Failure will be provided via chatter</li>
                                        </ol>
                                    </div>
                                </div>
                            </aura:if>
                        </aura:if>
                    </aura:if>
                </div>
                
            </lightning:layoutItem>
          </lightning:layout>
    </div>
    
    <aura:if isTrue="{!not(empty(v.attachedFiles))}">
        <div class="slds-p-top_large"><b>Files Uploaded:</b></div>
        <table class="slds-table slds-table--bordered">  
            <!-- hide the table header if file is empty -->
            
            <thead>  
                <tr>  
                    <th>Title</th>  
                    <th>File Type</th>  
                    <aura:if isTrue="{!not(v.isCommUser)}">
                        <th>Date Uploaded</th> 
                    </aura:if>
                    <th></th>                     
                </tr>  
            </thead>  
            
            <tbody>
                <aura:iteration items="{!v.attachedFiles}" var="f">  
                    <tr>  
                        <td>
                            <!--a style="pointer-events: none;">
                                {!f.Title}
                            </a-->
                            <lightning:button variant="base" label="{!f.Title}" 
                                               title="{!f.Title}" value="{!f.Id}"
                                               onclick="{! c.filePreviewhandler }"/>
                        </td>  
                        <td>{!f.FileType}</td>     
                        <aura:if isTrue="{!not(v.isCommUser)}">
                            <td>
                                <lightning:formattedDateTime value="{!f.CreatedDate}" year="numeric" month="numeric" day="numeric" hour="2-digit"
                                                             minute="2-digit" timeZoneName="short" hour12="true"/>
                            </td>   
                        </aura:if>
                        <td>
                            <a href="javascript:void(0)" id="{!f.Id}" onclick="{!c.deleteSelectedFile}">
                                <lightning:icon size="x-small" iconName="utility:delete" alternativeText="Delete" />
                            </a>
                        </td>
                    </tr>  
                </aura:iteration>  
            </tbody>  
        </table>
    </aura:if>
    <div class="slds-m-top_large">
       <aura:if isTrue="{!v.knowledgeId !=null &amp;&amp; v.PEO_Map!=null }">
                                  
                    <div class="slds-col slds-size_1-of-1 slds-large-size_12-of-12 slds-p-left_xx-large slds-p-horizontal_x-large " >
                       <div  style="font-size:16px;font-family: Graphik-Regular-Web;">What We're Looking For</div>
                        <!--lightning:formattedRichText value="{!v.PEO_Map.Hover_Description__c}"/-->
           </div><br/>
                    <div class="slds-col slds-size_1-of-1 slds-large-size_12-of-12 slds-p-left_xx-large slds-p-horizontal_x-large "
                          style="font-size:12px; font-family: Graphik-Regular-Web;">
                        <lightning:formattedRichText value="{!v.PEO_Map.Article_Body__c}"/>
                    </div>
                </aura:if> 
    </div>
    <!-- show spinner logo when needed -->
    <aura:if isTrue="{!v.showSpinner}">
        <div class="slds-spinner_container">
            <div class="slds-spinner slds-spinner--medium" aria-hidden="false" role="alert">
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
            </div>
        </div>
    </aura:if>
    
</aura:component>