<apex:page controller="LeadStrategyView_Controller" tabStyle="Lead_Strategy_Views__c">
  <c:PlatformTrackingComponent recordId="06670000000TYt5" objectType="LeadStrategyView" />       
  <apex:form >
    <apex:sectionHeader title="Lead Strategy Views" />
    <apex:pageBlock > 
       <apex:pageBlocksection columns="1" >
            <apex:outputText value="Pick the view you would like to see, then click Submit." />
            <apex:selectList value="{!controllerView}" title="Choose a View" onchange="controllerView(this.value)" size="7">
                <apex:selectOptions value="{!Viewslist}"/>
            </apex:selectList>
       </apex:pageBlockSection>
       <apex:pageBlocksection columns="2" >
            <apex:commandButton value="  Submit  " action="{!SOQLRecords}" rerender="view_detail" status="soqlStatus" />
            <apex:outputLink value="mailto:jhellbusch@paychex.com?subject=Lead%20Strategy%20View%20feedback">Click here to send us feedback and suggestions.</apex:outputLink>
            <apex:actionStatus id="soqlStatus" startText="   (searching...)" stopText=""/>
       </apex:pageBlockSection>
    </apex:pageBlock>
 
    <apex:pageBlock >  
      <apex:pageBlockSection columns="1" collapsible="true">
        <apex:outputPanel id="view_detail" >  

        <apex:pageMessages />          
         <apex:outputText value="Clicking on the name in the leftmost column will display the record details in a separate window." rendered="{!hasAnyRecords}"/>
             <apex:pageBlockTable value="{!viewResults}" var="rcd" width="100%" >             
                <apex:column style="white-space:nowrap;">
                    <apex:commandLink value="{!rcd.soName}" onclick="window.open('/' + '{!rcd.so.id}')">
                        <apex:param name="detailId" value="{!rcd.so.id}" assignTo="{!detailId}"/>
                    </apex:commandLink>
                </apex:column>
                 
                <apex:repeat value="{!ParentFields}" var="pfield" >
                    <apex:column style="white-space:wrap;" value="{!rcd.so[pfield.parentFldName]}" >
                        <apex:facet name="header" >
                            <apex:commandLink value="{!pfield.parentFldLabel}" action="{!sortRecords}" rerender="view_detail">
                                <apex:param name="sortObject" value="Parent" assignTo="{!sortObject}"/>
                                <apex:param name="sortField" value="{!pfield.parentFldName}"  assignTo="{!sortField}"/>
                            </apex:commandLink>                         
                        </apex:facet>
                    
                    </apex:column>          
               </apex:repeat>
               
                <apex:repeat value="{!ChildFields}" var="cfield" rendered="{!NOT(ISNULL(ChildFields))}">
                    <apex:column style="white-space:wrap;" value="{!rcd.soChild.child[cfield.childFldName]}">
                        <apex:facet name="header">
                            <apex:commandLink value="{!cfield.childFldLabel}" action="{!sortRecords}" rerender="view_detail">
                                <apex:param name="sortObject" value="Child" assignTo="{!sortObject}"/>
                                <apex:param name="sortField" value="{!cfield.childFldName}" assignTo="{!sortField}"/>
                            </apex:commandLink>                         
                        </apex:facet>
                    </apex:column>          
               </apex:repeat>

            </apex:pageBlockTable>
            
            <apex:panelGrid columns="5">              
                <apex:commandLink action="{!first}" rendered="{!hasAnyRecords}">First  </apex:commandLink>
                <apex:commandLink action="{!previous}" rendered="{!hasPrevious}"> Previous  </apex:commandLink>
                <apex:commandLink action="{!next}" rendered="{!hasNext}"> Next  </apex:commandLink>
                <apex:commandLink action="{!last}" rendered="{!hasAnyRecords}"> Last  </apex:commandLink>
                <apex:outputtext value=" -  Page {!pageNumber} of {!lastpageNumber}" rendered="{!hasAnyRecords}"/>
            </apex:panelGrid>
                
         </apex:outputPanel>
       </apex:pageBlockSection>
     </apex:pageBlock>
  </apex:form>
            
</apex:page>